import re
import os
import sys
import string
import subprocess
import urllib2

leixing=['CS-C1-11WPFR',
'CS-CDX1-11WPFR',
'CS-CDX2-21WPFR',
'CS-CDX2-21WPFR(B)',
'DR-9616N-ST',
'DS-2CD1103D-I',
'DS-2CD1103-I',
'DS-2CD1203D-I3',
'DS-2CD1203D-I5',
'DS-2CD1203-I5',
'DS-2CD1303D-I',
'DS-2CD1303-I',
'DS-2CD2012-I',
'DS-2CD2110FD-I',
'DS-2CD2110FD-IS',
'DS-2CD2110FD-IWS',
'DS-2CD2110F-I',
'DS-2CD2112D-I',
'DS-2CD2112F-I',
'DS-2CD2112-I',
'DS-2CD2120FD-I',
'DS-2CD2120FD-IS',
'DS-2CD2120F-IS',
'DS-2CD2132D-I',
'DS-2CD2132FD-IWS',
'DS-2CD2210D-I3',
'DS-2CD2210D-I5',
'DS-2CD2210D-I6DX',
'DS-2CD2210D-I7FY',
'DS-2CD2210D-TG',
'DS-2CD2210DX',
'DS-2CD2210-I3',
'DS-2CD2210-I5',
'DS-2CD2210TD-I5M',
'DS-2CD2212D-HT',
'DS-2CD2212D-I3',
'DS-2CD2212D-I5',
'DS-2CD2212D-IR5',
'DS-2CD2212D-ITD',
'DS-2CD2212DX',
'DS-2CD2212-I',
'DS-2CD2212-I3',
'DS-2CD2212-I5',
'DS-2CD2219DX-I3',
'DS-2CD221X-I3JS',
'DS-2CD2220D-I3',
'DS-2CD2220D-I5',
'DS-2CD2220H-IH',
'DS-2CD2220-I3',
'DS-2CD2220XYZ-ABCD',
'DS-2CD2232D-HX5',
'DS-2CD2232D-I3',
'DS-2CD2232D-I5',
'DS-2CD2232-I3',
'DS-2CD2232-I5',
'DS-2CD2239DX-I5',
'DS-2CD22XD-I',
'DS-2CD2310D-I',
'DS-2CD2310-I',
'DS-2CD2312D-I',
'DS-2CD2320D-I',
'DS-2CD2332D-I',
'DS-2CD2332-I',
'DS-2CD2410FD-IW',
'DS-2CD2412F-IW',
'DS-2CD2412F-IWTY',
'DS-2CD2432F-IW',
'DS-2CD2512F-IS',
'DS-2CD2532F-I',
'DS-2CD2532F-IWS',
'DS-2CD2610FD-I',
'DS-2CD2610FD-IS',
'DS-2CD2610F-DXI',
'DS-2CD2610F-I',
'DS-2CD2610F-IS',
'DS-2CD2612F-I',
'DS-2CD2612F-IS',
'DS-2CD2612FZ-I2S',
'DS-2CD2619DX-I',
'DS-2CD2620FD-IS',
'DS-2CD2620F-I',
'DS-2CD2632DX',
'DS-2CD2632F-I',
'DS-2CD2632F-IS',
'DS-2CD2710FD-I',
'DS-2CD2710FD-IS',
'DS-2CD2710F-I',
'DS-2CD2710F-IS',
'DS-2CD2710FWD-IS',
'DS-2CD2710YF-IZ',
'DS-2CD2712F-I',
'DS-2CD2712F-IS',
'DS-2CD2712T-HWS',
'DS-2CD2720FD-IS',
'DS-2CD2720F-I',
'DS-2CD2732F-I',
'DS-2CD2732F-IS',
'DS-2CD2810F',
'DS-2CD2810FD',
'DS-2CD2952FZ-I2S',
'DS-2CD2972F-I2S',
'DS-2CD2C10F-IW',
'DS-2CD2Q10FD-IGLE',
'DS-2CD2Q10FD-IW',
'DS-2CD2T10D-I3',
'DS-2CD2T10D-I5',
'DS-2CD2T10FD-I3',
'DS-2CD2T12D-I5',
'DS-2CD2T1P-I5TD',
'DS-2CD2T20D-I3',
'DS-2CD2T20D-I5',
'DS-2CD2T20-I3',
'DS-2CD2T20-I5',
'DS-2CD2T32D-HX5',
'DS-2CD3110FD-IS',
'DS-2CD3110FD-IWS',
'DS-2CD3112D-I',
'DS-2CD3112-I',
'DS-2CD3120F-IS',
'DS-2CD3132D-I',
'DS-2CD3132FD-IWS',
'DS-2CD3132-I',
'DS-2CD31MC',
'DS-2CD3210D-I3',
'DS-2CD3210D-I5',
'DS-2CD3210-I3',
'DS-2CD3210-I5',
'DS-2CD3212D-I3',
'DS-2CD3212D-I5',
'DS-2CD3212-I3',
'DS-2CD3212-I5',
'DS-2CD3220D-I3',
'DS-2CD3220D-I5',
'DS-2CD3220-I5',
'DS-2CD3232D-I3',
'DS-2CD3232D-I5',
'DS-2CD3232-I3',
'DS-2CD3232-I5',
'DS-2CD3310D-I',
'DS-2CD3310-I',
'DS-2CD3312D-I',
'DS-2CD3312-I',
'DS-2CD3320D-I',
'DS-2CD3320-I',
'DS-2CD3332D-I',
'DS-2CD3332-I',
'DS-2CD33ME',
'DS-2CD3410FD-IW',
'DS-2CD3412FD-IW',
'DS-2CD3A20FD-IS',
'DS-2CD3JWMC',
'DS-2CD3Q10FD-IW',
'DS-2CD3T20D-I3',
'DS-2CD3T20D-I5',
'DS-2CD3T20D-I8',
'DS-2CD3T20-I3',
'DS-2CD3T20-I5',
'DS-2CD3T25D-I3',
'DS-2CD3T32D-I3',
'DS-2CD3T32D-I5',
'DS-2CD3T32-I3',
'DS-2CD3T32-I5',
'DS-2CD3T35D-I5',
'DS-2CD3W10D-I3',
'DS-2CD4010F',
'DS-2CD4012F',
'DS-2CD4012F-GLE',
'DS-2CD4012FWD',
'DS-2CD4012FWD-A',
'DS-2CD4024F',
'DS-2CD4024F-A',
'DS-2CD4024FWD',
'DS-2CD4024M',
'DS-2CD4026EFWD',
'DS-2CD4026FWD',
'DS-2CD4026FWD-A',
'DS-2CD4026LY-D',
'DS-2CD4032FWD',
'DS-2CD4032FWD-A',
'DS-2CD4032FWD-GLT',
'DS-2CD4112F',
'DS-2CD4112F-I',
'DS-2CD4112FWD',
'DS-2CD4112FWD-IZ',
'DS-2CD4120F-I',
'DS-2CD4124F-I',
'DS-2CD4132FWD',
'DS-2CD4210F-IS',
'DS-2CD4212F-I',
'DS-2CD4212F-IZ',
'DS-2CD4212FWD-I',
'DS-2CD4212FWD-IS',
'DS-2CD4220F-I',
'DS-2CD4224F-I',
'DS-2CD4224F-IHA',
'DS-2CD4224F-IS',
'DS-2CD4224F-IZ',
'DS-2CD4232FWD-IS',
'DS-2CD42JM-I',
'DS-2CD4324F-I',
'DS-2CD4324F-IS',
'DS-2CD4A20F-IZ',
'DS-2CD4A25XYZUV-ABCDEF',
'DS-2CD4A26FWD-IZ',
'DS-2CD6225A-I',
'DS-2CD6412FWD-10',
'DS-2CD7129Y',
'DS-2CD7129-Y',
'DS-2CD7133-E',
'DS-2CD7164-E',
'DS-2CD7293PFWD-EIZ',
'DS-2CD733F-EI',
'DS-2CD753F-E',
'DS-2CD753F-EI',
'DS-2CD754F-EI',
'DS-2CD754FWD-E',
'DS-2CD755F-E',
'DS-2CD763PF-E',
'DS-2CD7644YF-EQ',
'DS-2CD764F-E',
'DS-2CD764F-EI',
'DS-2CD764FWD-E',
'DS-2CD764FWD-EI',
'DS-2CD783F-EI',
'DS-2CD7939PF-YI',
'DS-2CD7939-Y',
'DS-2CD793PF-E',
'DS-2CD793PF-EI',
'DS-2CD793PFWD-EI',
'DS-2CD7M4FWD-EZ',
'DS-2CD812PF-Y',
'DS-2CD812P-IRC',
'DS-2CD8153F-EW',
'DS-2CD8212-SH',
'DS-2CD8253F-EI',
'DS-2CD8253F-EIS',
'DS-2CD8254F-EI',
'DS-2CD82554-EI',
'DS-2CD82559-YIS',
'DS-2CD8255F-EI',
'DS-2CD82649-YIS',
'DS-2CD8264CPJ-EI',
'DS-2CD8264F-EI',
'DS-2CD8264F-EIA',
'DS-2CD8264F-EIS',
'DS-2CD8264FWD-E',
'DS-2CD8264FWD-EI',
'DS2CD8264FWD-EI',
'DS-2CD8266E-I3',
'DS-2CD833F-E',
'DS-2CD8433F-EIW',
'DS-2CD8464F-EI',
'DS-2CD8464F-EIW',
'DS-2CD8464F-EIWS',
'DS-2CD8464F-EIWTY',
'DS2CD852MF-E',
'DS-2CD853F-E',
'DS-2CD854F-E',
'DS-2CD8559-Y',
'DS-2CD855-EI3',
'DS-2CD855-EI5',
'DS-2CD855-ESD',
'DS-2CD855F-E',
'DS-2CD855F-IR5',
'DS2CD862MF-E',
'DS-2CD863PF-E',
'DS-2CD864-EI3',
'DS-2CD864-EI5',
'DS-2CD864-EIS',
'DS-2CD864F-E',
'DS-2CD864F-EIC',
'DS-2CD864FWD-E',
'DS-2CD864FWD-EW',
'DS-2CD864FWD-FC',
'DS-2CD877BF',
'DS-2CD883F-E',
'DS-2CD892P-IRD',
'DS-2CD893PF-E',
'DS-2CD893PFWD-DH',
'DS-2CD893PFWD-E',
'DS-2CD893PFWD-EW',
'DS-2CD893PF-Y',
'DS-2CD8DFDF-TEL',
'DS-2CD9111-S',
'DS-2CD9121A-S',
'DS-2CD9131-S',
'DS-2CD9152-HS',
'DS-2CD9182-H',
'DS-2CDX5-1',
'DS-2D9180X-A',
'DS-2DC5120I-A',
'DS-2DC5220I-A',
'DS-2DE1-5189',
'DS-2DE4172-AE',
'DS-2DE4172-AE3',
'DS-2DE4182-A',
'DS-2DE4182-AE',
'DS-2DE4220-DE',
'DS-2DE4572-A3',
'DS-2DE4582-A',
'DS-2DE4582-AE',
'DS-2DE5172-A',
'DS-2DE5174-A',
'DS-2DE5174-AE',
'DS-2DE5174-D',
'DS-2DE5176-A',
'DS-2DE5184-A',
'DS-2DE5186-A',
'DS-2DE7172-A',
'DS-2DE7174-A',
'DS-2DE7174-ADX',
'DS-2DE7174-D',
'DS-2DE7176-A',
'DS-2DE717F-GQ',
'DS-2DE717X-YZW',
'DS-2DE7182-A',
'DS-2DE7184-A',
'DS-2DE7184M-DX',
'DS-2DE7184XY-A',
'DS-2DE7186-A',
'DS-2DE7186-D',
'DS-2DE718-SD',
'DS-2DE71SY',
'DS-2DE71XD-A',
'DS-2DF1-402',
'DS-2DF1-5149',
'DS-2DF1-5169',
'DS-2DF1-518',
'DS-2DF1-5189',
'DS-2DF1-572',
'DS-2DF1-5732',
'DS-2DF1-574D',
'DS-2DF1-57BY',
'DS-2DF1-57DA',
'DS-2DF1-57DD',
'DS-2DF1-583',
'DS-2DF1-58DA/DX',
'DS-2DF1-5XYZ',
'DS-2DF1-714',
'DS-2DF1-716',
'DS-2DF1-7169',
'DS-2DF1-718',
'DS-2DF1-772',
'DS-2DF1-772-AF',
'DS-2DF1-774D',
'DS-2DF1-77A',
'DS-2DF1-77DF-DS',
'DS-2DF1-783',
'DS-2DF1-784D',
'DS-2DF1-78DY',
'DS-2DF1-78XYZ',
'DS-2DF5274-A',
'DS-2DF5274-AL',
'DS-2DF5274-AZW',
'DS-2DF5274C-A',
'DS-2DF5276-A3',
'DS-2DF5284-A',
'DS-2DF5286-A',
'DS-2DF52GL-AE3',
'DS-2DF52M-8AC',
'DS-2DF7230I3-A',
'DS-2DF7230I5-A',
'DS-2DF7272-A',
'DS-2DF7274',
'DS-2DF7274-A',
'DS-2DF7276-A',
'DS-2DF727D-A',
'DS-2DF727D-A/AX',
'DS-2DF727J-Q',
'DS-2DF7283-A',
'DS-2DF7284-A',
'DS-2DF7284-DHA',
'DS-2DF7286-A',
'DS-2DF7286-XYZ',
'DS-2DF728E-E3D',
'DS-2DF728G-M',
'DS-2DF728W-XYZL',
'DS-2DF7294-A',
'DS-2DF7294-D',
'DS-2DF7296-A',
'DS-2DF729D-Y',
'DS-2DF7CM8A-A',
'DS-2DF8223I-A',
'DS-2DF8223I-AW',
'DS-2DM1-504',
'DS-2DM1-512',
'DS-2DM1-514',
'DS-2DM1-517',
'DS-2DM1-51M',
'DS-2DM1-532',
'DS-2DM1-534',
'DS-2DM1-574D',
'DS-2DM1-713',
'DS-2DM1-714',
'DS-2DM1-716',
'DS-2DM1-717Q',
'DS-2DM1-772',
'DS-2DM1-774D',
'DS-2DM1-77Q',
'DS-2DM1-77X',
'DS-2DM5274-A',
'DS-2DM5274-A3',
'DS-2DM5274-D3',
'DS-2DM527Y-AYL',
'DS-2DM721C-A',
'DS-2DM7272-A',
'DS-2DM7274-A',
'DS-2DM7274-DX',
'DS-2DM727W-YD',
'DS-2DM727Y-AYL',
'DS-2DM7CM7A-A',
'DS-2DM7CM7B-A',
'DS-2DY9184-AI2',
'DS-2DY9185-HXA',
'DS-2DY9186-AI5',
'DS-2DZ2116',
'DS-2EDX7-1',
'DS-2ZCN2006',
'DS-2ZCN2007',
'DS-2ZMN2006(B)',
'DS-6601HC',
'DS-6601HC-SATA',
'DS-6601HF',
'DS-6601HFH',
'DS-6601HF-SATA',
'DS-6602HC',
'DS-6602HC-SATA',
'DS-6602HF',
'DS-6602HF-SATA',
'DS-6604HC',
'DS-6604HC-SATA',
'DS-6604HF',
'DS-6604HF-SATA',
'DS-66xx',
'DS-6701HW',
'DS-6701HW-SATA',
'DS-6704HF-SATA',
'DS-6704HW',
'DS-6704HW-SATA',
'DS-6708HW',
'DS-6708HW-SATA',
'DS-6D-I',
'DS-7204HFH-ST',
'DS-7204HF-SH',
'DS-7204HW-SH',
'DS-7208HF-SH',
'DS-7208HGH-SH',
'DS-7208HQH-SH',
'DS-7208HW-SH',
'DS-7216HFI-SH',
'DS-7216HF-SH',
'DS-7216HGH-SH',
'DS-7216HW-SH',
'DS-7216HW-SV',
'DS-7304HW-SH',
'DS-7308HGH-SH',
'DS-7308HW-SH',
'DS-7316HGH-SH',
'DS-7316HQH-SH',
'DS-7316HW-SH',
'DS-7324HW-SH',
'DS-7332HW-SH',
'DS-7604H-ST',
'DS-7604N-E1',
'DS-7604NI-PHK',
'DS-7604N-SE',
'DS-7608H-ST',
'DS-7608N-E1',
'DS-7608N-E2',
'DS-7608N-SE',
'DS-7608N-SP',
'DS-7608N-ST',
'DS-7616H-ST',
'DS-7616N-E1',
'DS-7616N-E2',
'DS-7616N-SE',
'DS-7616N-SP',
'DS-7616N-ST',
'DS-7632N-E2',
'DS-7708N-E4',
'DS-7708N-SP',
'DS-7708N-ST',
'DS-7716N-E4',
'DS-7716N-SP',
'DS-7716N-ST',
'DS-7732N-E4',
'DS-7732N-ST',
'DS-7804N-E1',
'DS-7804N-SH',
'DS-7808HW-E1',
'DS-7808N-E1',
'DS-7808N-E2',
'DS-7808N-SH',
'DS-7816-E1',
'DS-7816HE-E1',
'DS-7816H-SNT',
'DS-7816N-E1',
'DS-7816N-E2',
'DS-7816N-SH',
'DS-7832N-E2',
'DS-7908N-E4',
'DS-7916HH-SW',
'DS-7916N-E4',
'DS-7932N-E4',
'DS-8004HF-ST',
'DS-8008HF-ST',
'DS-8008HW-ST',
'DS-8016HF-ST',
'DS-8016HW-ST',
'DS-8104HE-SH',
'DS-8104HF-ST',
'DS-8104HS-SH',
'DS-8104HWS-SH',
'DS-8104HW-ST',
'DS-8104LHFH-E2',
'DS-8108HC-SH',
'DS-8108HD-S',
'DS-8108HE-SH',
'DS-8108HF-ST',
'DS-8108HQH-SH',
'DS-8108HS-SH',
'DS-8108HWS-SH',
'DS-8108HW-ST',
'DS-8116HC-SH',
'DS-8116HE-SH',
'DS-8116HFH-ST',
'DS-8116HF-ST',
'DS-8116HGHS-SH',
'DS-8116HQH-SH',
'DS-8116HQHS-SH',
'DS-8116HS-SH',
'DS-8116HWS-SH',
'DS-8116HW-ST',
'DS-8124HC-SH',
'DS-8124HS-SH',
'DS-8124HWS-SH',
'DS-8132HC-SH',
'DS-8132HS-SH',
'DS-8132HWS-SH',
'DS-8216HF-ST',
'DS-8608CG',
'DS-8608N-E8',
'DS-8608N-ST',
'DS-8608N-ST%2FRTA',
'DS-8616N-E8',
'DS-8616N-ST',
'DS-8616N-ST%2FRTA',
'DS-8632N-CU',
'DS-8632N-E8',
'DS-8632N-ST',
'DS-8664N-ST',
'DS-8664N-XT',
'DS-9004HF-ST',
'DS-9008HF-ST',
'DS-9008HW-ST',
'DS-9016HF-ST',
'DS-9016HW-ST',
'DS-9104HF-ST',
'DS-9104HW-ST',
'DS-9108HF-RT',
'DS-9108HF-ST',
'DS-9108HW-ST',
'DS-9116HF-RT',
'DS-9116HF-ST',
'DS-9116HW-ST',
'DS-9608N-RT',
'DS-9608N-ST',
'DS-9616N-RT',
'DS-9616N-ST',
'DS-9616N-XT',
'DS-9632N-H8',
'DS-9632N-ST',
'DS-9632N-XT',
'DS-9664N-ST',
'DS-9664N-XT',
'DS-FD16GG-F',
'DS-FN16CG',
'DS-LB130-12',
]
class MyException(Exception):
    pass

port=[80,81,82,83,8000,8008,8003,8888,8080,8002,8081,8082,8086,8089,8090,9090,8181]
location='C:\\Hikvision\\Hikvision-data.txt'

pattern_ip=re.compile('\d+.\d+.\d+.\d+')
pattern_num=re.compile('\d+/')
pattern_rtsp1='Server: Rtsp'
pattern_rtsp2='WWW-Auth'
pattern_http='SERVER:'
pattern_server='Server:'
pattern_public='Public:'
pattern_location='LOCATION:'
indata=open(location,'r')
pattern_usn='USN:'
outdata=open(location.strip('.txt')+'-output.txt','a+')

for line in indata:
    if line.strip('\n') in leixing:
        #leixing.remove(line.strip('\n'))
        print line
        outdata.write(line)
        brand=line.strip('\n')
        brandout=open('c:\\Hikvision\\brand.txt','a+')
        brandout.write(brand+'\n')
        continue
    elif re.match(pattern_ip,line):
        ip=re.match(pattern_ip,line).group()
        #print ip
    elif re.match(pattern_num,line):
        port_num=re.match(pattern_num,line).group().strip('/')
        #print port_num
        p=port_num
        if int(port_num) in port:
          print 'http://'+str(ip)+':'+port_num
          try:
            response=urllib2.urlopen('http://'+str(ip)+':'+str(port_num),timeout=10)
            tmp=''
            try:
             tmp=response.read()
            except:
                continue
            length=len(tmp)
            print length
            htmlout=open('C:\\Hikvision\\html\\'+brand+'--'+str(ip)+'-'+str(p)+'.txt','a+')
            htmlout.write(tmp)
            htmlout.close()
            outdata.write('http-length:'+str(length)+'\n')
          except: #urllib2.URLError,e:
             #print  e
             continue
        else:
          continue
    elif re.match(pattern_rtsp1,line):
        #outdata.write(line+'\n')
        pass
    elif re.match(pattern_rtsp2,line):
        outdata.write(line+'\n')
    elif re.match(pattern_http,line):
        outdata.write(line+'\n')
    elif re.match(pattern_public,line):
        outdata.write(line+'\n')
    elif re.match(pattern_server,line):
        outdata.write(line+'\n')
    elif re.match(pattern_location,line):
        outdata.write(line+'\n')
    elif re.match(pattern_usn,line):
        outdata.write(line+'\n')
    else:
        continue
brandout.close()
indata.close()
outdata.close()
